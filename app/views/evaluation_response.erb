<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= @result_set['dct:title']['@value'] %> - FAIR Champion</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .metadata { font-size: 0.9em; color: #666; }
    .test-output { margin-left: 20px; }
    .log { white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 3px; }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .pass { color: green; font-weight: bold; }
    .fail { color: red; font-weight: bold; }
    details { margin-top: 10px; }
    summary { cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>
  <h1><%= @result_set['dct:title']['@value'] %></h1>


  <div class="section">
    <h2>Test Results Overview</h2>
    <% total_tests = @result_set['prov:hadMember'].length %>
    <% pass_count = @result_set['prov:hadMember'].count { |member| @graph.find { |node| node['@id'] == member['@id'] }['prov:value']['@value'] == 'pass' } %>
    <% fail_count = total_tests - pass_count %>
    <% pass_percentage = total_tests > 0 ? (pass_count.to_f / total_tests * 100).round : 0 %>
    <% fail_percentage = 100 - pass_percentage %>
    <div style="display: flex; align-items: flex-end; height: 100px; width: 100%; max-width: 400px; margin: 10px 0;">
      <div style="flex: <%= pass_percentage %>; background: green; height: <%= pass_percentage %>px; margin-right: 2px;" title="Pass: <%= pass_count %> (<%= pass_percentage %>%)"></div>
      <div style="flex: <%= fail_percentage %>; background: red; height: <%= fail_percentage %>px;" title="Fail: <%= fail_count %> (<%= fail_percentage %>%)"></div>
    </div>
    <p style="font-size: 0.9em; color: #666;">
      <strong><%= pass_count %></strong> Passed (<%= pass_percentage %>%) | 
      <strong><%= fail_count %></strong> Failed (<%= fail_percentage %>%)
    </p>
  </div>


  <div class="section">
    <h2>Test Result Set</h2>
    <div class="metadata">
      <p><strong>ID:</strong> <%= @result_set['dct:identifier']['@id'] %></p>
      <p><strong>Description:</strong> <%= @result_set['dct:description']['@value'] %></p>
      <p><strong>License:</strong> <a href="<%= @result_set['dct:license']['@id'] %>"><%= @result_set['dct:license']['@id'] %></a></p>
      <p><strong>Generated By:</strong> <%= @result_set['prov:wasGeneratedBy']['@id'] %></p>
      <p><strong>Derived From:</strong> <a href="<%= @result_set['prov:wasDerivedFrom']['@id'] %>"><%= @result_set['prov:wasDerivedFrom']['@id'] %></a></p>
    </div>
  </div>

<div class="section">
  <h2>Test Outputs</h2>
  <% @result_set['prov:hadMember'].each_with_index do |member, index| %>
    <% test_result = @graph.find { |node| node['@id'] == member['@id'] } %>
    <% execution = @graph.find { |node| node['prov:generated'] && node['prov:generated']['@id'] == test_result['@id'] } %>
    <% test = @graph.find { |node| node['@id'] == execution['prov:wasAssociatedWith']['@id'] } %>
    <div class="test-output">
      <h3>Test Output <%= index + 1 %>: <%= test['dct:title']['@value'] %></h3>
      <div class="metadata">
        <p><strong>ID:</strong> <%= test_result['dct:identifier']['@id'] %></p>
        <p><strong>Description:</strong> <%= test_result['dct:description']['@value'] %></p>
        <p><strong>Result:</strong> <span class="<%= test_result['prov:value']['@value'] == 'pass' ? 'pass' : 'fail' %>"><%= test_result['prov:value']['@value'].capitalize %></span></p>
        <p><strong>Generated At:</strong> <%= test_result['prov:generatedAtTime']['@value'] %></p>
        <p><strong>Completion:</strong> <%= test_result['ftr:completion']['@value'] %>%</p>
        <p><strong>Test:</strong> <a href="<%= test['dcat:endpointURL']['@id'] %>"><%= test['dct:identifier'] %></a></p>
        <p><strong>Evaluated Metric:</strong> <a href="<%= test['sio:SIO_000233']['@id'] %>"><%= test['sio:SIO_000233']['@id'] %></a></p>
        <p><strong>Derived From:</strong> <a href="<%= test_result['prov:wasDerivedFrom']['@id'] %>"><%= test_result['prov:wasDerivedFrom']['@id'] %></a></p>
        <p><strong>License:</strong> <a href="<%= test_result['dct:license']['@id'] %>"><%= test_result['dct:license']['@id'] %></a></p>
        <% if test_result['ftr:summary']['@value'].to_s.strip.length > 0 %>
          <p><strong>Summary:</strong> <%= test_result['ftr:summary']['@value'] %></p>
        <% end %>
        <details>
          <summary>View Log</summary>
          <div class="log"><%= test_result['ftr:log']['@value'] %></div>
        </details>
      </div>
    </div>
  <% end %>
</div>
  <div class="section">
    <h2>Execution Details</h2>
    <% execution = @graph.find { |node| node['@id'] == @result_set['prov:wasGeneratedBy']['@id'] } %>
    <div class="metadata">
      <p><strong>Execution ID:</strong> <%= execution['@id'] %></p>
      <p><strong>Type:</strong> <%= execution['@type'] %></p>
      <p><strong>Used Resource:</strong> <a href="<%= execution['prov:used']['@id'] %>"><%= execution['prov:used']['@id'] %></a></p>
      <p><strong>Software Version:</strong> <%= execution['schema:softwareVersion']['@value'] %></p>
    </div>
  </div>
</body>
</html>